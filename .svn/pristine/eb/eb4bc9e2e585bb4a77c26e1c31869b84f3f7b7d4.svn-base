 var visaCommon = {
     attachChangeEvent: function() {

         $(document).on("change", "input[type='checkbox']", function() {
             var input = $(this).siblings("input")
             var checked = $(this).prop("checked");
             if (input) {
                 if (checked) {
                     $(input).prop("disabled", true);
                     $(this).siblings("label.error").remove();
                 } else {
                     $(input).prop("disabled", false);
                 }
             }
         });
         $(document).on("change", "input[type='radio'][data-tpl-id]", function() {
             var infoArea = $(this).siblings("div.area"),
                 $controlMenu = infoArea.children("div.control-menu"),
                 $counter = infoArea.children("input[type='hidden'][counter]"),
                 templateId = $(this).data("tpl-id"),
                 count = Number.parseInt($counter.val());
             if (count == 0) {
                 var $clone = visaCommon.renderTemplate(templateId, count);
                 $clone.insertBefore($controlMenu);
                 $counter.val(1);
             }
         });
         $(document).on("change", "select[data-show-condition]", function() {

             var $option = $(this).find("option:selected");
             var showAreaId = $option.data("show-area");
             if (showAreaId) {
                 var $showArea = $("#" + showAreaId);
                 $showArea.show(300) && $showArea.siblings("div.area").hide(300);
             } else {
                 $(this).siblings("div.area").hide(300);
             }
         })
         $(document).on("change", "input[type='radio']", function() {
             var infoArea = $(this).siblings("div.area");
             var checked = $(this).prop("checked");
             var isYes = utils.isYes($(this));
             var isShow = utils.isShow($(this));
             if (infoArea.length > 1) { //有多个同级info-area，表示为互斥填写区域
                 if (checked && isYes) {
                     $(infoArea[0]).show(300);
                     $(infoArea[1]).hide();
                 } else {
                     $(infoArea[1]).show(300);
                     $(infoArea[0]).hide();
                 }
             } else if (checked) {
                 isShow ? infoArea.show(300) : infoArea.hide(300);
             }
         });
     },
     attachAddDelEvent: function() {
         $("div.control-menu").each(function(index) {
             var $controlMenu = $(this),
                 $container = $controlMenu.parent(),
                 $counter = $controlMenu.siblings("input[counter]");

             var btns = $(this).children("a"),
                 $addBtn = $(btns[0]),
                 $delBtn = $(btns[1]);

             $addBtn.on("click", function() {
                 var count = Number.parseInt($counter.val() || 0),
                     expr = "input[type='radio'][data-tpl-id]",
                     templateId = $container.parent().children(expr).data("tpl-id");
                 var $clone = visaCommon.renderTemplate(templateId, count);
                 $clone.hide().insertBefore($controlMenu);
                 $clone.show(300);
                 $counter.val(count + 1);
             });
             $delBtn.on("click", function() {
                 var count = Number.parseInt($counter.val() || 0);
                 if (count > 1) {
                     $(this).parent().prev().hide(300, function() {
                         $(this).remove();
                         $counter.val(count - 1);
                     });
                 }
             });
         });
     },
     renderTemplate: function(templateId, count) {

         var $clone = $($("#" + templateId).html());
         $clone.find("input[type!='radio'],select,textarea").attr("id", function(index, id) {
             return id + "_" + count;
         }).attr("name", function(index, name) {
             return name + "_" + count;
         }).end();
         $clone.find("input[type='radio']").attr("id", function(index, id) {
             if (utils.isYes($(this))) {
                 return id + "Yes_" + count;
             } else if (utils.isNo($(this))) {
                 return id + "No_" + count;
             }
             return id;
         }).attr("name", function(index, name) {
             if (utils.isYes($(this))) {
                 return name + "_" + count;
             } else if (utils.isNo($(this))) {
                 return name + "_" + count;
             }
             return name;
         }).end();
         return $clone;

     }
 }
 var utils = {
     isYes: function(e) {
         return $(e).val().toUpperCase() == "Y" || $(e).val() == "1";
     },
     isNo: function(e) {
         return $(e).val().toUpperCase() == "N" || $(e).val() == "0";
     },
     hasTemplate: function(e) {
         return $(e).data("tpl-id") != undefined && $(e).data("tpl-id") != "";
     },
     isShow: function(e) {
         var showVal = $(e).data("is-show");
         var isYes = utils.isYes($(e));
         var isNo = utils.isNo($(e));
         if (showVal != undefined) {
             return showVal.toUpperCase() == "Y" || showVal == "0";
         }
         if (isYes) {
             return true;
         }
         if (isNo) {
             return false;
         }
         return false;
     }
 };
 (function() {
     $(document).ready(function() {
         visaCommon.attachChangeEvent();
         visaCommon.attachAddDelEvent();
         //动态加入验证函数
         $.validator.addMethod("phone", function(value) {
             return /^[\d]+$/.test(value);
         }, '请输入正确的电话号码');
     })
 })();